# 项目初始化

## 前期准备

一般来说，小程序在开发之前已经在微信申请。而一些工作需要在微信小程序的[管理界面](https://mp.weixin.qq.com/)来操作，这是一个微信的网页

![image-20230220114712560](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220114712560.png)

### 添加为开发者

在成员管理菜单下添加开发者，这样就可以用小程序开发工具进行开发

![image-20230220114931001](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220114931001.png)



### 下载微信开发者工具

![image-20230220115335752](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220115335752.png)

[下载链接](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)

### 拉取空工程

项目提供一个demo项目可以使用,按照一下流程操作

#### 1.拉取项目

`git clone `

#### 2.修改appid，以及环境信息

appid是小程序的唯一身份标识，在小程序申请完成后，可以在小程序管理页面，设置菜单中查看

![image-20230220162246493](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220162246493.png)



打开项目文件修改appid以及工程名称

![image-20230220162003436](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220162003436.png)

#### 3.使用微信开发者工具打开

![image-20230223152504375](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152504375.png)

#### 4.下依赖

![image-20230223152419850](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152419850.png)

#### 5.构建npm

![image-20230223152623675](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152623675.png)

#### 6.启动

开发时有缓存先清理缓存，无缓存则直接编译启动

![image-20230223152708333](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152708333.png)





# 通用组件

## 页面构建组件

司机端小程序开发的常用组件除了vant之外，还有一些自定义组件

### message

消息显示弹框组件

![image-20230227171516798](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230227171516798.png)

#### 使用示例

##### wxml

在wxml中使用message组件并设置id

```xml
<message id="tip"></message>

//... 
```

##### js

```javascript
Page({

somefunction(){
    
	this.showMsg("显示消息")
},
	
	

    // 通过组件示例调用组件方法
  showMsg(msg) {
    this.selectComponent("#tip").showMsg(msg);
  },
})


```

wxss

```css
Page {
  --theme-color: #1f8ceb;
}
```





#### API

##### props

| 参数名 | 类型 | 描述 | 是否必填 | 默认值 |
| ------ | ---- | ---- | -------- | ------ |
|        |      |      |          |        |

##### 方法

以下方法可以通过组件的实例调用，实现某些功能

###### showMsg

显示消息

* 参数

| 参数名  | 类型   | 描述             | 是否必填 | 默认值 |
| ------- | ------ | ---------------- | -------- | ------ |
| message | string | 组件要显示的消息 | 是       | 无     |

* 示例

```javascript
conponentInstance.showMsg("请确认xxx")
```

##### 样式

可以通过css变量设置消息组件的主题颜色

```css
 Page {
  --theme-color: #1f8ceb;
}
```





### Card、CardButton、CardField、CardFooter、CardHeader

这5个组件经常一起使用用来构成一个卡片

wcss

提供一个卡片与页面的空隙

```css
.wrapper{
  padding: 10*2rpx;
}
```

wxml

```xml
<view class="wrapper">
	<Card>
		<CardHeader slot="top">
			<view slot="name" class="top-left">
				XID: W51121
			</view>
			<view slot="status" class="status-text">
				已接收
			</view>
		</CardHeader>
		<view slot="mid">
			<CardField label="车型1">
				<text slot="value">卡车</text>
			</CardField>
			<CardField label="车牌号" value="沪A112233" />
			<CardField label="车型1">
				<text slot="value">卡车</text>
			</CardField>
			<CardField label="车牌号" value="沪A112233" />
			<CardField label="车型1">
				<text slot="value">卡车</text>
			</CardField>
			<CardField label="车牌号" value="沪A112233" />
		</view>
		<CardFooter slot="bottom">
			<view slot="hint" class="text">10辆</view>
			<CardButton slot='btns' bindtap="editOrder" data-id="{{item.id}}">
				编 辑
			</CardButton>
		</CardFooter>
	</Card>
</view>
```



<img src="https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230227175453464.png" alt="image-20230227175453464"  />



下面一一介绍这些组件

首先是最外部的Card组件，一般来说，他需要放在wrapper中，在Card中是没有外边距的。

#### Card

##### 代码

```xml
<view class="card">
	<view class="card-wrapper">
		<view class="top-mid-bottom-wrapper">
			<view class="top">
				<slot name="top" />
			</view>
			<view class="mid">
				<slot name="mid" />
			</view>
			<view class="bottom">
				<slot name="bottom" />
			</view>
		</view>
	</view>
</view>
```







### 

### date-picker

### empty

### FooterButton

### PageFooter

### imageUpload

### lov-picker

### output

### Steps、Step

## 列表页模板

小程序的常用页面类型。

![页面类型](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/fdece428955c44f2b6631573487859f7%40%E6%97%A0%E6%A0%87%E9%A2%9815.png)

- 普通列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/4aae5bca8aa0463bad401bf5d0a3ed1c@simpleList.rar)
- 普通 tab 列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/c36c23c66a804effac3335080c7b6ef0@simpleTapsList.rar)
- 带搜索的 tab 列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/1984379e3730412fb4aaa0a69ed4e7fa@searchSimpleTapsList.rar)
- 带搜索的列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/c20c77f2b4d74a56b2d124925487c35f@searchSimpleList.rar)
- 表单页

### 使用模板页面开发需要以下三个步骤 

1.选择适合的模板放入小程序

普通列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/4aae5bca8aa0463bad401bf5d0a3ed1c@simpleList.rar)

如果此时没有在TMS运输管理系统维护子应用，我们可以使用小程序开发工具的本地编译，编译特定页面。

首先在app.json将页面路径写入页面配置（示例放入了page,如果是客户自定义页面，则放入subpackages）,另外暂时注释调app.js的强制路由跳转代码（因为每次启动小程序首先会执行app.js,如果不注释调跳转，会使本地编译的页面无法达到）。



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/9390ff374b6d4399a506dec0f3c5dc7d%40%E6%97%A0%E6%A0%87%E9%A2%9825.png)



然后，设置本地编译模式，填写页面路由，编译页面。调试完成后，恢复app.js注释的代码

![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/4d8136ab52b8450294c16f6abf4b2b18%40%E6%97%A0%E6%A0%87%E9%A2%9824.png)



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/080a161dbda24281b1380942e11723d3%40%E6%97%A0%E6%A0%87%E9%A2%9826.png)



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/e3dfbdfcee474dce8fefe4b36c6de9b9%40%E6%97%A0%E6%A0%87%E9%A2%9827.png)



2.修改数据源

确认页面import路径正确，并且修改请求路径，如下图所示（注意：所有请求地址写在common/http文件中）

![页面js](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/8e69366cc2d5499bb49eaec71f61b9d3%40%E6%97%A0%E6%A0%87%E9%A2%9822.png)



3.修改页面内容

修改页面中卡片的内容，包扩CardHeader,CardFooter,以及`<view slot="mid">`

![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/8c5884e1e9e3485abb15dcb3a0d8283d%40%E6%97%A0%E6%A0%87%E9%A2%9823.png)



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/e3dfbdfcee474dce8fefe4b36c6de9b9%40%E6%97%A0%E6%A0%87%E9%A2%9827.png)

# 通用方法

小程序的通用方法在utils文件夹的util文件和extraFeat文件导出，其中，util文件是一些通用的小程序的方法；而extraFeat的内容是与hzero相关的方法，例如，获取坐标，逆向地址解析，获取值集，获取lov，宏的请求方法

## util



### promisify（这个方法包装小程序的回调API很有用）

转化微信的大多数方法，wx.xxx的条件，在很多时候是以下形式，使用此方法，可以将其转化为promise



当我们调用微信的扫码功能时，如果按照wx的API则写法为，这种写法获取结果是在success中的。

```javascript
wx.scanCode({
  success (res) {
    const {result} = res
    	
    wx.request({
        url:'',
        success(res){
            // do something
        }
        fail(res){
        	// do something
    	}
    })
    
  },
    fail(res){
        console.log("扫码失败")
    }
})
```

如果，层级比较少，代码不会有什么问题，然而在实际是开发中，回调里往往会执行其他的wxAPI，比如发请求。但是所有的wxAPI都是回调的形式，非常容易形成回调的嵌套，代码会变得越来越难以维护，所以我们可以使用promisify方法将wxAPI转化为promise的形式。如下所示

```javascript


try {
  const { result } = await promisify(wx.scanCode)();
  // do something
    
  const res = await promisify(wx.request)({
      url:'',
  })
  // do something
    
}catch(err){
    //失败
}

```

从下方的promisify实现代码中，我们可以知道，wxAPI是如何被转化为promise的形式的

#### 参数

| 参数 | 类型  | 描述               | 是否必输 | 默认值 |
| ---- | ----- | ------------------ | -------- | ------ |
| func | wxAPI | 要promise化的wxAPI | 是       | 无     |

#### 代码

```javascript
/**
 * @description promisify
 * @param {func} 函数 wxAPI
 * @return {*} promise化的函数
 */
function promisify(func) {
  return (options = {}) =>
    new Promise((resolve, reject) => {
      options.success = resolve;
      options.fail = reject;

      func(options);
    });
}
```

#### 示例

```javascript
// 
const { result } = await promisify(wx.scanCode)();
```



### wrapRequest

对请求类的wxApi包装，如wx.request,wx.uploadImage等等。在此方法中有对loading的全局控制，对网关的读取，请求日志打印（体验版），以及对错误的处理。

#### 参数

| 参数 | 类型            | 描述                  | 是否必输 | 默认值 |
| ---- | --------------- | --------------------- | -------- | ------ |
| func | 发起请求的wxAPI | 要被包装的微信请求API | 是       | 无     |



其作为结果返回的函数的参数

| 参数      | 类型                      | 描述                                                         | 是否必输 | 默认值 |
| --------- | ------------------------- | ------------------------------------------------------------ | -------- | ------ |
| 来源WXAPI | 发起请求的wxAPI的擦拭农户 | 与发起请求的wxAPI的传递参数一致，success,failed,complete不用传 | 是       | 无     |
| raw       | boolean                   | 是否不处理返回结果，原数据直接返回                           | 否       | false  |
| loading   | boolean                   | 是都显示loading                                              | 否       | true   |






#### 示例

* 微信请求类方法



```javascript
// 包装wx的请求方法
const request = wrapRequest(wx.request)

// options使用wx.request的原本参数
request(option)

// 包装wx的上传文件请求方法
const uploadFile = wrapRequest(wx.uploadFile)
// options使用wx.request的原本参数
uploadFile(options)

// 包装wx的下载文件请求方法
const downloadFile =wrapRequest(wx.downloadFile)
// options使用wx.request的原本参数
downloadFile(options)
```



### request

上面说过，可以使用wrapRequest来包装wxAPI的请求方法。鉴于wx.request使用的频繁程度，通用方法中直接将wx.request包装，并在util文件中暴露出来，作为工具方法使用。

#### 参数

| 参数      | 类型                                                         | 描述                                                      | 是否必输 | 默认值 |
| --------- | ------------------------------------------------------------ | --------------------------------------------------------- | -------- | ------ |
| 来源WXAPI | [wx.request的参数](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html) | 与wx.request的传递参数一致，success,failed,complete不用传 | 是       | 无     |
| raw       | boolean                                                      | 是否不处理返回结果，原数据直接返回                        | 否       | false  |
| loading   | boolean                                                      | 是都显示loading                                           | 否       | true   |

![image-20230227154852091](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230227154852091.png)



#### 代码

```javascript
const request = wrapRequest(wx.request);
```



#### 示例

此方法通常应用于页面中请求的发送

```javascript
import {request} from '../../utils/util'

Page({
 
    
    async querySomething(){
        
        // 参数
       const options = {
    		url:'getShipment',
    		method:"GET"
		}
       // 请求
       const {success,data,message} = await request(options) 
       
       
       
    }
})
```





### mergeObj

浅合并两个对象

#### 参数

这是一个高阶函数

用法为

`mergeObj(targetObject)(mergeObject)`

| 参数         | 类型        | 描述             | 是否必输 | 默认值 |
| ------------ | ----------- | ---------------- | -------- | ------ |
| targetObject | plainObject | 合并到的目标对象 | 是       | 无     |
| mergeObject  | plainObject | 要合并的数据     | 是       | 无     |



#### 用法

```javascript
const inner = {
    searchParms:""
}

console.log(inner.searchParms)// ""

// 这么做就可以合并把searchParms的值合并到inner对象
mergeObj(this.inner)({searchParms:5121})

console.log(inner.searchParms)// 5121

```





### getDataSet

获取微信点击事件传递的参数

#### 参数

| 参数 | 类型         | 描述                                     | 是否必输 | 默认值 |
| ---- | ------------ | ---------------------------------------- | -------- | ------ |
| e    | 点击事件对象 | wxml绑定的事件函数，默认被传入的事件对象 | 是       | 无     |



#### 示例

在页面中有需要传递参数时往往会绑定点击事件，并设置参数data-参数名

```xml
<view bindtab="handleCilck" data-id="5121"></view>
```
在绑定的事件中就可以直接获取传递的参数

```javascript
function handleCilck(e){
    
    const {id} = getDataSet(e)
    
    console.log(id) // 5121
}
```



### goback

返回上一级页面,并显示消息

#### 参数

| 参数  | 类型   | 描述                       | 是否必输 | 默认值 |
| ----- | ------ | -------------------------- | -------- | ------ |
| msg   | string | 返回到页面后显示消息的文本 | 否       | 无     |
| delta | number | 返回几层页面               | 否       | 1      |



#### 示例

```javascript
// 返回上一级
goback()

// 返回到上一级，并且在上一级显示 ‘任务已提交’
goback("任务已提交")

```



### showWxMsg

#### 参数

| 参数     | 类型   | 描述                                                         | 是否必输 | 默认值  |
| -------- | ------ | ------------------------------------------------------------ | -------- | ------- |
| msg      | string | 微信消息的文本                                               | 是       | 无      |
| icon     | string | 微信消息的图标可选值同[wx.showToast](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showToast.html) | 否       | success |
| duration | number | 消息promise延迟的时间                                        | 否       | 1500    |



封装微信提示信息，等待信息提示完成之后，再继续执行某些操作

#### 代码

```javascript
/**
 * @description 微信提示信息
 * @param {string} msg 要显示的消息
 * @param {string} icon 显示图标
 * @return {*}
 * @example showWxMsg('加载成功')
 * @example showWxMsg('加载失败','error')
 */
async function showWxMsg(msg, icon = "success", duration = 1500) {
  wx.showToast({
    title: msg,
    icon,
    duration,
  });
  return await new Promise(function (resolve) {
    let id = setTimeout(() => {
      resolve();
      clearTimeout(id);
    }, duration);
  });
}
```



#### 示例

```javascript
 // 提示执行成功
showWxMsg('执行成功')
// 提示执行失败
showWxMsg('执行失败','error')

// 控制显示时长,3000毫秒
showWxMsg('执行失败','error',3000)

```

promise用法，消息显示完成之后promise会resolve

```javascript

async someEvent(){
 // do something
   
    // 显示消息
   await showWxMsg("执行成功")
    
    // 显示完成后 do something ，比方说，跳转到什么页面
    
    jumpToOtherPage()
    
    
}

```





### getParent

获取上一个页面的实例

#### 参数

无参数

#### 代码

```javascript
/**
 * @description 获取上一个页面的页面对象，直接操作Page实例
 * @param {*}
 * @return {*}
 * @example
 * const parent = getParent()
 * parent.queryInfo();
 * parent.setData({
 *    a:1
 * });
 */
function getParent() {
  const pages = getCurrentPages();
  return pages[pages.length - 2];
}
```



#### 用法

```javascript
function midifySomeData(){
    
    const parent = getParent()

    // 改变父页面的渲染数据
    parent.setData({userName:"xxx"})
    // 改变父页面的内部数据
    mergeObj(parent.inner)({metaData:{a:1}})
    // 调用父页面的方法
    parent.excuteMethodA()
    

}
```

### formatTime

格式化时间，讲时间对象格式化为字符串

#### 参数

| 参数   | 类型    | 描述               | 是否必输 | 默认值   |
| ------ | ------- | ------------------ | -------- | -------- |
| date   | Date    | 要格式化的时间     | 否       | 当前时间 |
| isDate | boolean | 是否只格式化年月日 | 否       | false    |



#### 示例

```javascript
// 格式化当前时间
const timeString = formatTime()

console.log(timeString)  // 2023-02-23 23:23:23

// 格式化固定时间
const time = new Date("2022-02-22 22:22:22")
const timeString =formatTime(time)
console.log(timeString)  // 2022-02-22 22:22:22

// 只获取年月日
const time = new Date("2022-02-22 22:22:22",true)
const timeString =formatTime(time)
console.log(timeString)  // 2022-02-22

```



### getDateTime

获取时间的年月日时分秒信息

#### 参数

| 参数 | 类型 | 描述           | 是否必输 | 默认值   |
| ---- | ---- | -------------- | -------- | -------- |
| date | Date | 要格式化的时间 | 否       | 当前时间 |



#### 示例

```javascript
// 获取当前时间的信息
const timeInfo= getDateTime()
console.log(timeInfo)
/*
{
    "year": "2023",
    "month": "02",
    "day": "27",
    "hour": "13",
    "minute": "42",
    "second": "07"
}

*/

//获取具体时间的信息
const time = new Date("2022-02-22 22:22:22")
const timeInfo = getDateTime(time)
console.log(timeInfo)
/*
{
    "year": "2022",
    "month": "02",
    "day": "22",
    "hour": "22",
    "minute": "22",
    "second": "22"
}
*/
```





### getTimepiece

输入秒数，获取时分秒信息

#### 参数

| 参数       | 类型   | 描述       | 是否必输 | 默认值 |
| ---------- | ------ | ---------- | -------- | ------ |
| secondTime | number | 要处理的秒 | 是       |        |



#### 示例

```javascript
const input = 541

const timepiece =getTimepiece(input)

console.log(timepiece)// {hours: 0, minutes: 9, seconds: 1}
```







### isPhone

手机号校验

参数

| 参数  | 类型   | 描述           | 是否必输 | 默认值 |
| ----- | ------ | -------------- | -------- | ------ |
| phone | string | 要检验的手机号 | 是       |        |



#### 示例

```javascript
const phoneInput = '5201314'
const isOk = isPhone(phoneInput)
console.log(isOk)// false
```



### debounce

生成防抖函数

#### 参数

| 参数  | 类型   | 描述                     | 是否必输 | 默认值 |
| ----- | ------ | ------------------------ | -------- | ------ |
| func  | string | 要进行防抖包装的函数     | 是       |        |
| delay | number | 防抖的时间延迟，单位毫秒 | 否       | 200    |



#### 示例

```javascript
// 随着数据框实时变化
const inputNumber = 1

// 计算总价
function countTotal(){
    const price = 20
	return inputNumber*price
}

// 将计算总价包装为延时1500毫秒的防抖函数
const debounceCountTotal= debounce(countTotal,1500)

function inputEvent(e){
    
    // 无防抖,每次输入都会执行计算总价
    countTotal()
    // 有防抖，输入后才会执行计算总价
    debounceCountTotal()
}


```



### setManyGlobal

存储对象到globalData（小程序的全局对象）

#### 参数

| 参数 | 类型        | 描述                                   | 是否必输 | 默认值 |
| ---- | ----------- | -------------------------------------- | -------- | ------ |
| obj  | plainObject | 要合并到globalData的数据,｛key:value｝ | 是       |        |



#### 示例

```javascript
// 将currentName存到全局对象

const saveData = {
    currentName:'Luke'
}
setManyGlobal(saveData)

// 查看
const app = getApp();

const {currentName} = app.globalData

console.log(currentName)// Luke


```



### getGlobalData

#### 参数

| 参数 | 类型   | 描述                          | 是否必输 | 默认值 |
| ---- | ------ | ----------------------------- | -------- | ------ |
| key  | string | 要从globalData读取的数据的key | 是       |        |



#### 示例



```javascript
// 将currentName存到全局对象

const saveData = {
    currentName:'Luke'
}
setManyGlobal(saveData)
// 获取
const {currentName} = getGlobalData(currentName)

console.log(currentName)// Luke

```





## extraFeat（额外TMS系统方法）

有关TMS系统的方法

### getAddress

#### 参数

参数为一个option对象，具体的参数如下

| 参数            | 类型    | 描述                | 是否必输 | 默认值 |
| --------------- | ------- | ------------------- | -------- | ------ |
| options.lon     | number  | 经度                | 是       | 无     |
| options.lat     | number  | 维度                | 是       | 无     |
| options.loading | boolean | 页面是否显示loading | 否       | true   |



#### 示例

```javascript

// 经度：121.12
// 纬度：31.15

const coordinate={
    lon:121.12,
   	lat: 31.15
}
const resp = await getAddress(coordinate)

const { 
    result: {
        address,
        address_component: { province, city, district },
      }
} = resp

console.log(address) // 上海市青浦区浦仓路449弄43号
console.log(province) // 上海市
console.log(city) // 上海市
console.log(district) // 青浦区



console.log(resp)

/*

{
    "status": 0,
    "message": "query ok",
    "request_id": "4edbb8ae-2c33-461c-a8fa-f4436b658a9f",
    "result": {
        "location": {
            "lat": 31.15,
            "lng": 121.12
        },
        "address": "上海市青浦区浦仓路449弄43号",
        "formatted_addresses": {
            "recommend": "青浦区农工商超市通天大厦(欧洲街东)",
            "rough": "青浦区农工商超市通天大厦(欧洲街东)"
        },
        "address_component": {
            "nation": "中国",
            "province": "上海市",
            "city": "上海市",
            "district": "青浦区",
            "street": "浦仓路",
            "street_number": "浦仓路449弄43号"
        },
        "ad_info": {
            "nation_code": "156",
            "adcode": "310118",
            "city_code": "156310000",
            "name": "中国,上海市,上海市,青浦区",
            "location": {
                "lat": 31.15098,
                "lng": 121.124249
            },
            "nation": "中国",
            "province": "上海市",
            "city": "上海市",
            "district": "青浦区"
        },
        "address_reference": {
            "crossroad": {
                "id": "5133361",
                "title": "公园路/浦仓路(路口)",
                "location": {
                    "lat": 31.14885,
                    "lng": 121.12119
                },
                "_distance": 165.3,
                "_dir_desc": "西北"
            },
            "town": {
                "id": "310118001",
                "title": "夏阳街道",
                "location": {
                    "lat": 31.148199,
                    "lng": 121.126107
                },
                "_distance": 0,
                "_dir_desc": "内"
            },
            "street_number": {
                "id": "466150456281011866920",
                "title": "浦仓路449弄43号",
                "location": {
                    "lat": 31.15,
                    "lng": 121.12012
                },
                "_distance": 11.4
            },
            "street": {
                "id": "7136973893087502017",
                "title": "欧洲街",
                "location": {
                    "lat": 31.149948,
                    "lng": 121.119415
                },
                "_distance": 47.5,
                "_dir_desc": "东"
            },
            "landmark_l1": {
                "id": "12417371313296853192",
                "title": "农工商超市(青浦店)",
                "location": {
                    "lat": 31.149418,
                    "lng": 121.120767
                },
                "_distance": 97.5,
                "_dir_desc": "西北"
            },
            "landmark_l2": {
                "id": "5364917062835696718",
                "title": "通天大厦",
                "location": {
                    "lat": 31.149917,
                    "lng": 121.119831
                },
                "_distance": 0,
                "_dir_desc": "内"
            }
        }
    }
}

*/


```





### getLocation

获取小程序当前坐标值

#### 参数

参数为一个option对象，具体的参数如下

| 参数                                                 | 类型    | 描述                                                   | 是否必输 | 默认值 |
| ---------------------------------------------------- | ------- | ------------------------------------------------------ | -------- | ------ |
| options.needTransfer                                 | boolean | 是否转化为百度坐标系                                   | 否       | false  |
| options.isCheckPositionPermission                    | boolean | 是否检查位置权限                                       | 否       | true   |
| options.checkPositionPermissionOptions.isBackGround  | boolean | 校验位置权限是否为后台也可获取位置                     | 否       | true   |
| options.checkPositionPermissionOptions.isOpenSetting | boolean | 检验权限不通过时，是否打开权限设置，让用户设置位置权限 |          |        |



#### 示例

```javascript
// 获取当前位置坐标
const {longitude,latitude} = await getLocation();

// 获取百度坐标系坐标
const {rawLon,rawLat} = await getLocation({needTransfer:true});


```



### getlookUpCode

获取lookupCode

#### 参数

| 参数       | 类型   | 描述                                         | 是否必输 | 默认值 |
| ---------- | ------ | -------------------------------------------- | -------- | ------ |
| lookUpCode | string | 值集code                                     | 是       | 无     |
| lookUpPara | string | 值集参数，添加到查询url后面，例如 "&a=1&b=2" | 否       | 无     |



#### 示例

```javascript
const data = await getlookUpCode("HTMS.SCAN_TYPE");
console.log("data", data);
// 值集
/*
[
    {"value":"LOAD","meaning":"装车扫描","orderSeq":1},
    {"value":"UNLOAD","meaning":"卸车扫描","orderSeq":2}
]
*/

```

### getLov

获取Lov值集数据

#### 参数

| 参数    | 类型   | 描述                                         | 是否必输 | 默认值 |
| ------- | ------ | -------------------------------------------- | -------- | ------ |
| lovCode | string | Lov值集code                                  | 是       | 无     |
| lovPara | string | 值集参数，添加到查询url后面，例如 "&a=1&b=2" | 否       | 无     |



#### 示例

```javascript

 const data = await getLov("HTMS.ORDER_TYPE_LOV");
 console.log("data", data);

/*
[
	{"xid":"SALES_ORDER","name":"国内销售","id":11,"value":11,"meaning":"国内销售"},		{"xid":"PURCHASE_ORDER","name":"国内采购","id":12,"value":12,"meaning":"国内采购"},		{"xid":"DISPATCH_ORDER","name":"调拨计划","id":13,"value":13,"meaning":"调拨计划"},		{"xid":"DELIVERY_ORDER","name":"配送订单","id":22,"value":22,"meaning":"配送订单"},		{"xid":"OVERSEASALES_ORDER","name":"销售出口","id":24,"value":24,"meaning":"销售出口"},
    {"xid":"RETURN_ORDER","name":"退货订单","id":27,"value":27,"meaning":"退货订单"},		{"xid":"RIVER_SHIP_ORDER","name":"江船订单","id":31,"value":31,"meaning":"江船订单"},	{"xid":"IMPORT_PURCHASE","name":"采购进口","id":32,"value":32,"meaning":"采购进口"},	{"xid":"WWJG","name":"委外加工（出库单）","id":33,"value":33,"meaning":"委外加工（出库单）"},
    {"xid":"WWJG1","name":"委外加工（入库单）","id":34,"value":34,"meaning":"委外加工（入库单）"},
	{"xid":"TEST-11416-POC-B1","name":"POC-药品销库","id":43,"value":43,"meaning":"POC-药品销售出库"},
	{"xid":"TEST-11416-POC-B2","name":"POC-器械销库","id":44,"value":44,"meaning":"POC-器械销售出库"}
]
*/
```





### macroRequest

宏调用

#### 参数

宏调用参数为宏请求的参数，其ts类型如下

```typescript
type listItem = {
  id: any;
};

type MacroPrams = {
  paramIn: {
    list?: listItem[];
    [key: string]: any;
  };
  macroCode: string;
};
```



| 参数        | 类型       | 描述             | 是否必输 | 默认值 |
| ----------- | ---------- | ---------------- | -------- | ------ |
| macroParams | MacroPrams | 宏请求发送的参数 | 是       | 无     |



#### 示例

```javascript

const macroParams = {
     paramIn: {
            list: [{
              id
    		}],	
         // 一些其他参数
     },
    macroCode:"SAVE_OR"
}

const {success,data,message} = await macroRequest(macroParams);


// 宏消息
const macroMessage = getMacroMsg(data) || message


```



### getMacroMsg

获取宏调用的报错消息



#### 参数

| 参数 | 类型         | 描述                                      | 是否必输 | 默认值 |
| ---- | ------------ | ----------------------------------------- | -------- | ------ |
| data | macroRespons | 宏调用返回的response中的data,具体查看示例 | 是       | 无     |



#### 示例

```javascript
const macroParams = {
     paramIn: {
            list: [{
              id
    		}],	
         // 一些其他参数
     },
    macroCode:"SAVE_OR"
}

const {success,data,message} = await macroRequest(macroParams);


// 宏消息
const macroMessage = getMacroMsg(data) || message
```



### getSubAppParameterByCode

获取子应用参数值

#### 参数

| 参数       | 类型   | 描述           | 是否必输 | 默认值 |
| ---------- | ------ | -------------- | -------- | ------ |
| subAppCode | string | 子应用代码     | 是       | 无     |
| code       | string | 配置参数的code | 是       | 无     |



#### 示例

获取下图中的点检模板参数

![image-20230227150451876](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230227150451876.png)



```javascript
const params = await getSubAppParameterByCode("TMS_DRIVER_TASK", "tmsAppSpConfirmPickup")

console.log(params) // TMS_APP_SP_CONFIRM_PICKUP

```



### bdgcj2String

转化百度坐标系为火星坐标系

#### 参数

此方法参数为一个地点对象location，具体参数如下



| 参数               | 类型   | 描述 | 是否必输 | 默认值 |
| ------------------ | ------ | ---- | -------- | ------ |
| location.longitude | number | 经度 | 是       | 无     |
| location.latitude  | number | 纬度 | 是       | 无     |

#### 示例

```javascript
// 百度坐标系
const location = {longitude:311, latitude:311}

const translocation = bdgcj2String(location)

console.log(translocation)
/*
 {
     // baidu坐标系
    rawLon: 311,
    rowLat: 311,
     // 火星坐标系
    longitude: 520,
    latitude:520,
  };
*/
```



