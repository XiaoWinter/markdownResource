# 项目初始化

## 前期准备

一般来说，小程序在开发之前已经在微信申请。而一些工作需要在微信小程序的[管理界面](https://mp.weixin.qq.com/)来操作，这是一个微信的网页

![image-20230220114712560](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220114712560.png)

### 添加为开发者

在成员管理菜单下添加开发者，这样就可以用小程序开发工具进行开发

![image-20230220114931001](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220114931001.png)



### 下载微信开发者工具

![image-20230220115335752](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220115335752.png)

[下载链接](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)

### 拉取空工程

项目提供一个demo项目可以使用,按照一下流程操作

#### 1.拉取项目

`git clone `

#### 2.修改appid，以及环境信息

appid是小程序的唯一身份标识，在小程序申请完成后，可以在小程序管理页面，设置菜单中查看

![image-20230220162246493](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220162246493.png)



打开项目文件修改appid以及工程名称

![image-20230220162003436](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230220162003436.png)

#### 3.使用微信开发者工具打开

![image-20230223152504375](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152504375.png)

#### 4.下依赖

![image-20230223152419850](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152419850.png)

#### 5.构建npm

![image-20230223152623675](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152623675.png)

#### 6.启动

开发时有缓存先清理缓存，无缓存则直接编译启动

![image-20230223152708333](https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/image-20230223152708333.png)





# 通用组件

## 页面构建组件

司机端小程序开发的常用组件除了vant之外，还有一些自定组件

### Card

### CardButton

### CardField

### CardFooter

### CardHeader

### date-picker

### empty

### FooterButton

### imageUpload

### lov-picker

### message

### output

### PageFooter

### Step

## 列表页模板

小程序的常用页面类型。

![页面类型](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/fdece428955c44f2b6631573487859f7%40%E6%97%A0%E6%A0%87%E9%A2%9815.png)

- 普通列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/4aae5bca8aa0463bad401bf5d0a3ed1c@simpleList.rar)
- 普通 tab 列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/c36c23c66a804effac3335080c7b6ef0@simpleTapsList.rar)
- 带搜索的 tab 列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/1984379e3730412fb4aaa0a69ed4e7fa@searchSimpleTapsList.rar)
- 带搜索的列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/c20c77f2b4d74a56b2d124925487c35f@searchSimpleList.rar)
- 表单页

### 使用模板页面开发需要以下三个步骤 

1.选择适合的模板放入小程序

普通列表页 [页面模板](https://handtms-static.obs.cn-east-3.myhuaweicloud.com:443/component/0/4aae5bca8aa0463bad401bf5d0a3ed1c@simpleList.rar)

如果此时没有在TMS运输管理系统维护子应用，我们可以使用小程序开发工具的本地编译，编译特定页面。

首先在app.json将页面路径写入页面配置（示例放入了page,如果是客户自定义页面，则放入subpackages）,另外暂时注释调app.js的强制路由跳转代码（因为每次启动小程序首先会执行app.js,如果不注释调跳转，会使本地编译的页面无法达到）。



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/9390ff374b6d4399a506dec0f3c5dc7d%40%E6%97%A0%E6%A0%87%E9%A2%9825.png)



然后，设置本地编译模式，填写页面路由，编译页面。调试完成后，恢复app.js注释的代码

![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/4d8136ab52b8450294c16f6abf4b2b18%40%E6%97%A0%E6%A0%87%E9%A2%9824.png)



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/080a161dbda24281b1380942e11723d3%40%E6%97%A0%E6%A0%87%E9%A2%9826.png)



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/e3dfbdfcee474dce8fefe4b36c6de9b9%40%E6%97%A0%E6%A0%87%E9%A2%9827.png)



2.修改数据源

确认页面import路径正确，并且修改请求路径，如下图所示（注意：所有请求地址写在common/http文件中）

![页面js](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/8e69366cc2d5499bb49eaec71f61b9d3%40%E6%97%A0%E6%A0%87%E9%A2%9822.png)



3.修改页面内容

修改页面中卡片的内容，包扩CardHeader,CardFooter,以及`<view slot="mid">`

![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/8c5884e1e9e3485abb15dcb3a0d8283d%40%E6%97%A0%E6%A0%87%E9%A2%9823.png)



![](https://handtms-static.obs.cn-east-3.myhuaweicloud.com/component/0/e3dfbdfcee474dce8fefe4b36c6de9b9%40%E6%97%A0%E6%A0%87%E9%A2%9827.png)

# 通用方法

小程序的通用方法在utils文件夹的util文件和extraFeat文件导出，其中，util文件是一些通用的小程序的方法；而extraFeat的内容是与hzero相关的方法，例如，获取坐标，逆向地址解析，获取值集，获取lov，宏的请求方法

## util



### promisify

转化微信的大多数方法，wx.xxx的条件，在很多时候是以下形式，使用此方法，可以将其转化为promise

```javascript
{
    success:xxx,
    fail:xxx,
        ......
}
```

代码

```javascript
/**
 * @description promisify
 * @param {*} 函数 fun({success:xxx,fail:xxx})
 * @return {*} promise化的函数
 */
function promisify(func) {
  return (options = {}) =>
    new Promise((resolve, reject) => {
      options.success = resolve;
      options.fail = reject;

      func(options);
    });
}
```

示例

```javascript
// 
const { result } = await promisify(wx.scanCode)();
```



### wrapRequest



### request

### mergeObj

### getDataSet

获取微信点击事件传递的参数

代码

```javascript
/**
 * @description 获取组件上的dataset信息
 * @param {*}
 * @return {*}
 * @example
 * 使用方式
 *
 * <view bindtab="handleCilck"></view>
 *
 * function handleCilck(e){
 *  const dataSet = getDataSet(e)
 * }
 */
function getDataSet(e) {
  const {
    currentTarget: { dataset },
  } = e;
  return dataset;
}	
```

示例

```xml
<view bindtab="handleCilck" data-id="114514"></view>
```

```javascript
function handleCilck(e){
    const {id} = getDataSet(e)
}
```





### getMacroMsg

### goback

### showWxMsg

### getParent

获取上一个页面的实例

代码

```javascript
/**
 * @description 获取上一个页面的页面对象，直接操作Page实例
 * @param {*}
 * @return {*}
 * @example
 * const parent = getParent()
 * parent.queryInfo();
 * parent.setData({
 *    a:1
 * });
 */
function getParent() {
  const pages = getCurrentPages();
  return pages[pages.length - 2];
}
```

用法

```javascript
function midifySomeData(){
    
    const parent = getParent()

    // 改变父页面的渲染数据
    parent.setData({userName:"xxx"})
    // 改变父页面的内部数据
    mergeObj(parent.inner)({metaData:{a:1}})
    // 调用父页面的方法
    parent.excuteMethodA()
    

}
```

### formatTime



### getDateTime

### getTimepiece

### isPhone

### debounce

### setManyGlobal

### getGlobalData

## extraFeat

### getAddress

### getLocation

### getlookUpCode

### getLov

### macroRequest

### getSubAppParameterByCode

### bdgcj2String

